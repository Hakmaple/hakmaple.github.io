<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>CATCTF-Reverse-CatFly Writeup | Hakmaple&#39;s Blog</title>
  <meta name="author" content="hakmaple">
  
  <meta name="description" content="Analysis查看文件类型
~/CTF_Challenges/Reverse/CatFly$ file CatFly CatFly: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=d05baf98f7d937f503c87ced28e78998e8d3046b, for GNU/Linux 3.2.0, stripped

main函数IDA伪代码如下：
__int64 __fastcall main(int a1, char **a2, char **a3)&amp;#123;  size_t v3; // rbx  _WORD v5[4]; // [rsp+10h] [rbp-4B0h] BYREF  time_t time1; // [rsp+18h] [rbp-4A8h] BYREF  time_t timer; // [rsp+20h] [rbp-4A0h] BYREF  int longind; // [rsp+2Ch] [rbp-494h] BYREF  _QWORD s[129]; // [rsp+30h] [rbp-490h] BYREF  int v10; // [rsp+43Ch] [rbp-84h]  double v11; // [rsp+440h] [rbp-80h]  char *v12; // [rsp+448h] [rbp-78h]  int v13; // [rsp+450h] [rbp-70h]  unsigned int v14; // [rsp+454h] [rbp-6Ch]  unsigned __int8 v15; // [rsp+45Ah] [rbp-66h]  char v16; // [rsp+45Bh] [rbp-65h]  int n; // [rsp+45Ch] [rbp-64h]  int v18; // [rsp+460h] [rbp-60h]  char v19; // [rsp+467h] [rbp-59h]  int m; // [rsp+468h] [rbp-58h]  int k; // [rsp+46Ch] [rbp-54h]  char v22; // [rsp+473h] [rbp-4Dh]  int v23; // [rsp+474h] [rbp-4Ch]  unsigned __int64 v24; // [rsp+478h] [rbp-48h]  int v25; // [rsp+484h] [rbp-3Ch]  int v26; // [rsp+488h] [rbp-38h]  int v27; // [rsp+48Ch] [rbp-34h]  char v28; // [rsp+490h] [rbp-30h]  bool v29; // [rsp+491h] [rbp-2Fh]  unsigned __int16 v30; // [rsp+492h] [rbp-2Eh]  int v31; // [rsp+494h] [rbp-2Ch]  unsigned int v32; // [rsp+498h] [rbp-28h]  unsigned int i; // [rsp+49Ch] [rbp-24h]  int v34; // [rsp+4A0h] [rbp-20h]  unsigned int j; // [rsp+4A4h] [rbp-1Ch]  char *haystack; // [rsp+4A8h] [rbp-18h]  haystack = 0;  i = 0;  v32 = 0;  v31 = 0;  memset(s, 0, 1024);  v30 = 0;  v29 = 0;  v28 = 0;  v27 = 90;  while ( 1 )  &amp;#123;    v26 = getopt_long(a1, a2, &amp;quot;eshiItnd:f:r:R:c:C:W:H:&amp;quot;, &amp;amp;longopts, &amp;amp;longind);    if ( v26 == -1 )      break;    if ( !v26 &amp;amp;&amp;amp; !*((_QWORD *)&amp;amp;longopts.flag + 4 * longind) )      v26 = *(&amp;amp;longopts.val + 8 * longind);    switch ( v26 )    &amp;#123;      case &amp;#x27;C&amp;#x27;:        dword_E1F8 = atoi(optarg);        break;      case &amp;#x27;H&amp;#x27;:        dword_E1EC = (64 - atoi(optarg)) / 2;        dword_E1F0 = (atoi(optarg) + 64) / 2;        break;      case &amp;#x27;I&amp;#x27;:        v28 = 1;        break;      case &amp;#x27;R&amp;#x27;:        dword_E1F0 = atoi(optarg);        break;      case &amp;#x27;W&amp;#x27;:        dword_E1F4 = (64 - atoi(optarg)) / 2;        dword_E1F8 = (atoi(optarg) + 64) / 2;        break;      case &amp;#x27;c&amp;#x27;:        dword_E1F4 = atoi(optarg);        break;      case &amp;#x27;d&amp;#x27;:        if ( atoi(optarg) &amp;gt; 9 &amp;amp;&amp;amp; atoi(optarg) &amp;lt;= 1000 )          v27 = atoi(optarg);        break;      case &amp;#x27;e&amp;#x27;:        dword_E104 = 0;        break;      case &amp;#x27;f&amp;#x27;:        dword_104C4 = atoi(optarg);        break;      case &amp;#x27;h&amp;#x27;:        sub_67F0(a2);        exit(0);      case &amp;#x27;i&amp;#x27;:        v29 = 1;        break;      case &amp;#x27;r&amp;#x27;:        dword_E1EC = atoi(optarg);        break;      case &amp;#x27;s&amp;#x27;:        dword_E108 = 0;        break;      case &amp;#x27;t&amp;#x27;:        dword_104C0 = 1;        break;      default:        continue;    &amp;#125;  &amp;#125;  if ( dword_104C0 )  &amp;#123;    v29 = v28 == 0;    sub_6669();    for ( i = 0; i &amp;lt;= 0xFF; ++i )    &amp;#123;      if ( *((_BYTE *)&amp;amp;unk_104E0 + i) )      &amp;#123;        sub_66AF(*((unsigned __int8 *)&amp;amp;unk_104E0 + i), i);        fflush(stdout);      &amp;#125;    &amp;#125;    for ( i = 0; i &amp;lt;= 0xFF; ++i )    &amp;#123;      if ( *((_BYTE *)&amp;amp;unk_105E0 + i) )      &amp;#123;        sub_66AF(*((unsigned __int8 *)&amp;amp;unk_105E0 + i), i);        fflush(stdout);      &amp;#125;    &amp;#125;    signal(14, sub_64C0);    if ( !_setjmp(env) )    &amp;#123;      alarm(1u);      while ( !feof(stdin) &amp;amp;&amp;amp; v32 &amp;lt;= 1 )      &amp;#123;        v16 = getchar();        v15 = 0;        if ( v16 == -1 )        &amp;#123;          v16 = getchar();          switch ( v16 )          &amp;#123;            case -16:              v31 = 0;              if ( LOBYTE(s[0]) == 24 )              &amp;#123;                alarm(2u);                haystack = strndup((const char *)s + 2, 0x3FEu);                ++v32;              &amp;#125;              else if ( LOBYTE(s[0]) == 31 )              &amp;#123;                alarm(2u);                dword_E1FC = (BYTE1(s[0]) &amp;lt;&amp;lt; 8) | BYTE2(s[0]);                dword_E200 = (BYTE3(s[0]) &amp;lt;&amp;lt; 8) | BYTE4(s[0]);                ++v32;              &amp;#125;              break;            case -15:              sub_66AF(241, 0);              fflush(stdout);              break;            case -6:              v31 = 1;              v30 = 0;              memset(s, 0, 0x400u);              break;            case -5:            case -4:              v15 = getchar();              if ( !*((_BYTE *)&amp;amp;unk_105E0 + v15) )                *((_BYTE *)&amp;amp;unk_105E0 + v15) = -4;              sub_66AF(*((unsigned __int8 *)&amp;amp;unk_105E0 + v15), v15);              fflush(stdout);              if ( v16 == -5 &amp;amp;&amp;amp; v15 == 24 )              &amp;#123;                printf(&amp;quot;%c%c%c%c%c%c&amp;quot;, 255, 250, 24, 1, 255, 240);                fflush(stdout);              &amp;#125;              break;            case -3:            case -2:              v15 = getchar();              if ( !*((_BYTE *)&amp;amp;unk_104E0 + v15) )                *((_BYTE *)&amp;amp;unk_104E0 + v15) = -2;              sub_66AF(*((unsigned __int8 *)&amp;amp;unk_104E0 + v15), v15);              fflush(stdout);              break;            case -1:              v32 = 2;              break;            default:              continue;          &amp;#125;        &amp;#125;        else if ( v31 &amp;amp;&amp;amp; v30 &amp;lt;= 0x3FEu )        &amp;#123;          *((_BYTE *)s + v30++) = v16;        &amp;#125;      &amp;#125;    &amp;#125;    alarm(0);  &amp;#125;  else  &amp;#123;    haystack = getenv(&amp;quot;TERM&amp;quot;);    ioctl(0, 0x5413u, v5);    dword_E1FC = v5[1];    dword_E200 = v5[0];  &amp;#125;  v34 = 2;  if ( haystack )  &amp;#123;    for ( j = 0; ; ++j )    &amp;#123;      v3 = j;      if ( v3 &amp;gt;= strlen(haystack) )        break;      haystack[j] = tolower(haystack[j]);    &amp;#125;    if ( strstr(haystack, &amp;quot;xterm&amp;quot;) )    &amp;#123;      v34 = 1;    &amp;#125;    else if ( strstr(haystack, &amp;quot;toaru&amp;quot;) )    &amp;#123;      v34 = 1;    &amp;#125;    else if ( strstr(haystack, &amp;quot;linux&amp;quot;) )    &amp;#123;      v34 = 3;    &amp;#125;    else if ( strstr(haystack, &amp;quot;vtnt&amp;quot;) )    &amp;#123;      v34 = 5;    &amp;#125;    else if ( strstr(haystack, &amp;quot;cygwin&amp;quot;) )    &amp;#123;      v34 = 5;    &amp;#125;    else if ( strstr(haystack, &amp;quot;vt220&amp;quot;) )    &amp;#123;      v34 = 6;    &amp;#125;    else if ( strstr(haystack, &amp;quot;fallback&amp;quot;) )    &amp;#123;      v34 = 4;    &amp;#125;    else if ( strstr(haystack, &amp;quot;rxvt-256color&amp;quot;) )    &amp;#123;      v34 = 1;    &amp;#125;    else if ( strstr(haystack, &amp;quot;rxvt&amp;quot;) )    &amp;#123;      v34 = 3;    &amp;#125;    else if ( strstr(haystack, &amp;quot;vt100&amp;quot;) &amp;amp;&amp;amp; dword_E1FC == 40 )    &amp;#123;      v34 = 7;    &amp;#125;    else if ( !strncmp(haystack, &amp;quot;st&amp;quot;, 2u) )    &amp;#123;      v34 = 1;    &amp;#125;  &amp;#125;  v25 = 0;  signal(2, sub_64A8);  signal(13, sub_64E6);  if ( !dword_104C0 )    signal(28, handler);  switch ( v34 )  &amp;#123;    case 1:      qword_FE20 = (__int64)&amp;quot;\x1B[48;5;17m&amp;quot;;      qword_FE30 = (__int64)&amp;quot;\x1B[48;5;231m&amp;quot;;      qword_FDF8 = (__int64)&amp;quot;\x1B[48;5;16m&amp;quot;;      qword_FEC0 = (__int64)&amp;quot;\x1B[48;5;230m&amp;quot;;      qword_FDE0 = (__int64)&amp;quot;\x1B[48;5;175m&amp;quot;;      qword_FE28 = (__int64)&amp;quot;\x1B[48;5;162m&amp;quot;;      qword_FEB0 = (__int64)&amp;quot;\x1B[48;5;196m&amp;quot;;      qword_FDF0 = (__int64)&amp;quot;\x1B[48;5;214m&amp;quot;;      qword_FE18 = (__int64)&amp;quot;\x1B[48;5;226m&amp;quot;;      qword_FDD8 = (__int64)&amp;quot;\x1B[48;5;118m&amp;quot;;      qword_FEA8 = (__int64)&amp;quot;\x1B[48;5;33m&amp;quot;;      qword_FE98 = (__int64)&amp;quot;\x1B[48;5;19m&amp;quot;;      qword_FE10 = (__int64)&amp;quot;\x1B[48;5;240m&amp;quot;;      qword_FDE8 = (__int64)&amp;quot;\x1B[48;5;175m&amp;quot;;      break;    case 2:      qword_FE20 = (__int64)&amp;quot;\x1B[104m&amp;quot;;      qword_FE30 = (__int64)&amp;quot;\x1B[107m&amp;quot;;      qword_FDF8 = (__int64)&amp;quot;\x1B[40m&amp;quot;;      qword_FEC0 = (__int64)&amp;quot;\x1B[47m&amp;quot;;      qword_FDE0 = (__int64)&amp;quot;\x1B[105m&amp;quot;;      qword_FE28 = (__int64)&amp;quot;\x1B[101m&amp;quot;;      qword_FEB0 = (__int64)&amp;quot;\x1B[101m&amp;quot;;      qword_FDF0 = (__int64)&amp;quot;\x1B[43m&amp;quot;;      qword_FE18 = (__int64)&amp;quot;\x1B[103m&amp;quot;;      qword_FDD8 = (__int64)&amp;quot;\x1B[102m&amp;quot;;      qword_FEA8 = (__int64)&amp;quot;\x1B[104m&amp;quot;;      qword_FE98 = (__int64)&amp;quot;\x1B[44m&amp;quot;;      qword_FE10 = (__int64)&amp;quot;\x1B[100m&amp;quot;;      qword_FDE8 = (__int64)&amp;quot;\x1B[105m&amp;quot;;      break;    case 3:      qword_FE20 = (__int64)&amp;quot;\x1B[25;44m&amp;quot;;      qword_FE30 = (__int64)&amp;quot;\x1B[5;47m&amp;quot;;      qword_FDF8 = (__int64)&amp;quot;\x1B[25;40m&amp;quot;;      qword_FEC0 = (__int64)&amp;quot;\x1B[5;47m&amp;quot;;      qword_FDE0 = (__int64)&amp;quot;\x1B[5;45m&amp;quot;;      qword_FE28 = (__int64)&amp;quot;\x1B[5;41m&amp;quot;;      qword_FEB0 = (__int64)&amp;quot;\x1B[5;41m&amp;quot;;      qword_FDF0 = (__int64)&amp;quot;\x1B[25;43m&amp;quot;;      qword_FE18 = (__int64)&amp;quot;\x1B[5;43m&amp;quot;;      qword_FDD8 = (__int64)&amp;quot;\x1B[5;42m&amp;quot;;      qword_FEA8 = (__int64)&amp;quot;\x1B[25;44m&amp;quot;;      qword_FE98 = (__int64)&amp;quot;\x1B[5;44m&amp;quot;;      qword_FE10 = (__int64)&amp;quot;\x1B[5;40m&amp;quot;;      qword_FDE8 = (__int64)&amp;quot;\x1B[5;45m&amp;quot;;      break;    case 4:      qword_FE20 = (__int64)&amp;quot;\x1B[0;34;44m&amp;quot;;      qword_FE30 = (__int64)&amp;quot;\x1B[1;37;47m&amp;quot;;      qword_FDF8 = (__int64)&amp;quot;\x1B[0;30;40m&amp;quot;;      qword_FEC0 = (__int64)&amp;quot;\x1B[1;37;47m&amp;quot;;      qword_FDE0 = (__int64)&amp;quot;\x1B[1;35;45m&amp;quot;;      qword_FE28 = (__int64)&amp;quot;\x1B[1;31;41m&amp;quot;;      qword_FEB0 = (__int64)&amp;quot;\x1B[1;31;41m&amp;quot;;      qword_FDF0 = (__int64)&amp;quot;\x1B[0;33;43m&amp;quot;;      qword_FE18 = (__int64)&amp;quot;\x1B[1;33;43m&amp;quot;;      qword_FDD8 = (__int64)&amp;quot;\x1B[1;32;42m&amp;quot;;      qword_FEA8 = (__int64)&amp;quot;\x1B[1;34;44m&amp;quot;;      qword_FE98 = (__int64)&amp;quot;\x1B[0;34;44m&amp;quot;;      qword_FE10 = (__int64)&amp;quot;\x1B[1;30;40m&amp;quot;;      qword_FDE8 = (__int64)&amp;quot;\x1B[1;35;45m&amp;quot;;      off_FA88 = (char *)&amp;amp;unk_BCFF;      break;    case 5:      qword_FE20 = (__int64)&amp;quot;\x1B[0;34;44m&amp;quot;;      qword_FE30 = (__int64)&amp;quot;\x1B[1;37;47m&amp;quot;;      qword_FDF8 = (__int64)&amp;quot;\x1B[0;30;40m&amp;quot;;      qword_FEC0 = (__int64)&amp;quot;\x1B[1;37;47m&amp;quot;;      qword_FDE0 = (__int64)&amp;quot;\x1B[1;35;45m&amp;quot;;      qword_FE28 = (__int64)&amp;quot;\x1B[1;31;41m&amp;quot;;      qword_FEB0 = (__int64)&amp;quot;\x1B[1;31;41m&amp;quot;;      qword_FDF0 = (__int64)&amp;quot;\x1B[0;33;43m&amp;quot;;      qword_FE18 = (__int64)&amp;quot;\x1B[1;33;43m&amp;quot;;      qword_FDD8 = (__int64)&amp;quot;\x1B[1;32;42m&amp;quot;;      qword_FEA8 = (__int64)&amp;quot;\x1B[1;34;44m&amp;quot;;      qword_FE98 = (__int64)&amp;quot;\x1B[0;34;44m&amp;quot;;      qword_FE10 = (__int64)&amp;quot;\x1B[1;30;40m&amp;quot;;      qword_FDE8 = (__int64)&amp;quot;\x1B[1;35;45m&amp;quot;;      off_FA88 = (char *)&amp;amp;unk_BD06;      break;    case 6:      qword_FE20 = (__int64)&amp;amp;unk_BD09;      qword_FE30 = (__int64)&amp;amp;unk_BD0C;      qword_FDF8 = (__int64)&amp;quot;  &amp;quot;;      qword_FEC0 = (__int64)&amp;amp;unk_BD0F;      qword_FDE0 = (__int64)&amp;amp;unk_BD12;      qword_FE28 = (__int64)&amp;amp;unk_BD15;      qword_FEB0 = (__int64)&amp;amp;unk_BD0F;      qword_FDF0 = (__int64)&amp;amp;unk_BD18;      qword_FE18 = (__int64)&amp;amp;unk_BD1B;      qword_FDD8 = (__int64)&amp;amp;unk_BD1E;      qword_FEA8 = (__int64)&amp;amp;unk_BD21;      qword_FE98 = (__int64)&amp;amp;unk_BD24;      qword_FE10 = (__int64)&amp;amp;unk_BD27;      qword_FDE8 = (__int64)&amp;amp;unk_BD2A;      v25 = 1;      break;    case 7:      qword_FE20 = (__int64)&amp;amp;unk_BD2D;      qword_FE30 = (__int64)&amp;amp;unk_BD2F;      qword_FDF8 = (__int64)&amp;amp;unk_BD31;      qword_FEC0 = (__int64)&amp;amp;unk_BD33;      qword_FDE0 = (__int64)&amp;amp;unk_BD35;      qword_FE28 = (__int64)&amp;amp;unk_BD37;      qword_FEB0 = (__int64)&amp;amp;unk_BD33;      qword_FDF0 = (__int64)&amp;amp;unk_BD39;      qword_FE18 = (__int64)&amp;amp;unk_BD3B;      qword_FDD8 = (__int64)&amp;amp;unk_BD3D;      qword_FEA8 = (__int64)&amp;amp;unk_BD3F;      qword_FE98 = (__int64)&amp;amp;unk_BD41;      qword_FE10 = (__int64)&amp;amp;unk_BD43;      qword_FDE8 = (__int64)&amp;amp;unk_BD45;      v25 = 1;      dword_E1FC = 40;      break;    default:      break;  &amp;#125;  if ( dword_E1F4 == dword_E1F8 )  &amp;#123;    dword_E1F4 = (dword_E1FC / -2 + 64) / 2;    dword_E1F8 = (dword_E1FC / 2 + 64) / 2;    byte_104CB = 1;  &amp;#125;  if ( dword_E1EC == dword_E1F0 )  &amp;#123;    dword_E1EC = (65 - dword_E200) / 2;    dword_E1F0 = (dword_E200 + 63) / 2;    byte_104CC = 1;  &amp;#125;  if ( dword_E108 )  &amp;#123;    printf(&amp;quot;\x1BkNyanyanyanyanyanyanya...\x1B\\&amp;quot;);    printf(&amp;quot;\x1B]1;Nyanyanyanyanyanyanya...\a&amp;quot;);    printf(&amp;quot;\x1B]2;Nyanyanyanyanyanyanya...\a&amp;quot;);  &amp;#125;  if ( dword_E104 )    printf(&amp;quot;\x1B[H\x1B[2J\x1B[?25l&amp;quot;);  else    printf(&amp;quot;\x1B[s&amp;quot;);  if ( v29 )  &amp;#123;    v14 = 5;    for ( j = 0; j &amp;lt; v14; ++j )    &amp;#123;      sub_65E2(3);      printf(&amp;quot;                             \x1B[1mNyancat Telnet Server\x1B[0m&amp;quot;);      sub_65E2(2);      printf(&amp;quot;                   written and run by \x1B[1;32mK. Lange\x1B[1;34m @_klange\x1B[0m&amp;quot;);      sub_65E2(2);      printf(&amp;quot;        If things don&amp;#x27;t look right, try:&amp;quot;);      sub_65E2(1);      printf(&amp;quot;                TERM=fallback telnet ...&amp;quot;);      sub_65E2(2);      printf(&amp;quot;        Or on Windows:&amp;quot;);      sub_65E2(1);      printf(&amp;quot;                telnet -t vtnt ...&amp;quot;);      sub_65E2(2);      printf(&amp;quot;        Problems? Check the website:&amp;quot;);      sub_65E2(1);      printf(&amp;quot;                \x1B[1;34mhttp://nyancat.dakko.us\x1B[0m&amp;quot;);      sub_65E2(2);      printf(&amp;quot;        This is a telnet server, remember your escape keys!&amp;quot;);      sub_65E2(1);      printf(&amp;quot;                \x1B[1;31m^]quit\x1B[0m to exit&amp;quot;);      sub_65E2(2);      printf(&amp;quot;        Starting in %d...                \n&amp;quot;, v14 - j);      fflush(stdout);      usleep(0x61A80u);      if ( dword_E104 )        printf(&amp;quot;\x1B[H&amp;quot;);      else        printf(&amp;quot;\x1B[u&amp;quot;);    &amp;#125;    if ( dword_E104 )      printf(&amp;quot;\x1B[H\x1B[2J\x1B[?25l&amp;quot;);  &amp;#125;  time(&amp;amp;timer);  v13 = 1;  v24 = 0;  v23 = 0;  v22 = 0;  v12 = off_FA88;  while ( v13 )  &amp;#123;    if ( dword_E104 )      printf(&amp;quot;\x1B[H&amp;quot;);    else      printf(&amp;quot;\x1B[u&amp;quot;);    for ( k = dword_E1EC; k &amp;lt; dword_E1F0; ++k )    &amp;#123;      for ( m = dword_E1F4; m &amp;lt; dword_E1F8; ++m )      &amp;#123;        if ( k &amp;lt;= 23 || k &amp;gt; 42 || m &amp;gt;= 0 )        &amp;#123;          if ( m &amp;gt;= 0 &amp;amp;&amp;amp; (unsigned int)k &amp;lt; 0x40 &amp;amp;&amp;amp; m &amp;lt;= 63 )          &amp;#123;            v19 = off_FA20[v24][k][m];            off_FA88 = (char *)sub_6314((unsigned int)v24, (unsigned int)k, (unsigned int)m, v12);          &amp;#125;          else          &amp;#123;            v19 = 44;          &amp;#125;        &amp;#125;        else        &amp;#123;          v18 = (2 - m) % 16 / 8;          if ( ((v24 &amp;gt;&amp;gt; 1) &amp;amp; 1) != 0 )            v18 = 1 - v18;          s[128] = &amp;quot;,,&amp;gt;&amp;gt;&amp;amp;&amp;amp;&amp;amp;+++###==;;;,,&amp;quot;;          v19 = asc_BFE3[v18 - 23 + k];          if ( !v19 )            v19 = 44;        &amp;#125;        if ( v25 )        &amp;#123;          printf(&amp;quot;%s&amp;quot;, *((const char **)&amp;amp;unk_FCC0 + v19));        &amp;#125;        else if ( v19 == v22 || !*((_QWORD *)&amp;amp;unk_FCC0 + v19) )        &amp;#123;          printf(&amp;quot;%s&amp;quot;, off_FA88);        &amp;#125;        else        &amp;#123;          v22 = v19;          printf(&amp;quot;%s%s&amp;quot;, *((const char **)&amp;amp;unk_FCC0 + v19), off_FA88);        &amp;#125;      &amp;#125;      sub_65E2(1);    &amp;#125;    if ( dword_E100 )    &amp;#123;      time(&amp;amp;time1);      v11 = difftime(time1, timer);      v10 = sub_63FF((unsigned int)(int)v11);      for ( n = (dword_E1FC - 29 - v10) / 2; n &amp;gt; 0; --n )        putchar(32);      dword_E1E8 += printf(&amp;quot;\x1B[1;37mYou have nyaned for %d times!\x1B[J\x1B[0m&amp;quot;, ++dword_108E0);    &amp;#125;    v22 = 0;    ++v23;    if ( dword_104C4 &amp;amp;&amp;amp; v23 == dword_104C4 )      sub_6471();    if ( !off_FA20[++v24] )      v24 = 0;    usleep(1000 * v27);  &amp;#125;  return 0;&amp;#125;

注意到这一部分，printf(&amp;quot;%s&amp;quot;, off_FA88);这里我们进一步跟进 off_FA88看到了对它的赋值操作 off_FA88 = sub_6314((unsigned int)v24, k, m, (__int64)v12);此时我们查看sub_6314的源代码
if ( m &amp;gt;= 0 &amp;amp;&amp;amp; (unsigned int)k &amp;lt; 0x40 &amp;amp;&amp;amp; m &amp;lt;= 63 )          &amp;#123;            v19 = off_FA20[v24][k][m];            off_FA88 = (char *)sub_6314((unsigned int)v24, (unsigned int)k, (unsigned int)m, v12);          &amp;#125;          else          &amp;#123;            v19 = 44;

以下是sub_6314的代码：
char *__fastcall sub_6314(__int64 a1, int a2, int a3, __int64 a4)&amp;#123;  if ( a2 != 18 )    return (char *)a4;  if ( a3 &amp;lt;= 4 || a3 &amp;gt; 54 )    return (char *)a4;  byte_104C9 = 32;  dword_E120[a3 - 5] ^= sub_62B5();  if ( (unsigned __int8)sub_62E3(dword_E120[a3 - 5]) )    byte_104C8 = dword_E120[a3 - 5] &amp;amp; 0x7F;  else    byte_104C8 = 32;  return &amp;amp;byte_104C8;&amp;#125;

sub_62B5"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="CATCTF-Reverse-CatFly Writeup"/>
  <meta property="og:site_name" content="Hakmaple&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Hakmaple&#39;s Blog" type="application/atom+xml">
  
  
    <link href="/cat.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 7.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Hakmaple&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> CATCTF-Reverse-CatFly Writeup</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><p>查看文件类型</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~/CTF_Challenges/Reverse/CatFly$ file CatFly </span><br><span class="line">CatFly: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=d05baf98f7d937f503c87ced28e78998e8d3046b, <span class="keyword">for</span> GNU/Linux 3.2.0, stripped</span><br></pre></td></tr></table></figure>

<p>main函数IDA伪代码如下：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// rbx</span></span><br><span class="line">  _WORD v5[<span class="number">4</span>]; <span class="comment">// [rsp+10h] [rbp-4B0h] BYREF</span></span><br><span class="line">  <span class="type">time_t</span> time1; <span class="comment">// [rsp+18h] [rbp-4A8h] BYREF</span></span><br><span class="line">  <span class="type">time_t</span> timer; <span class="comment">// [rsp+20h] [rbp-4A0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> longind; <span class="comment">// [rsp+2Ch] [rbp-494h] BYREF</span></span><br><span class="line">  _QWORD s[<span class="number">129</span>]; <span class="comment">// [rsp+30h] [rbp-490h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+43Ch] [rbp-84h]</span></span><br><span class="line">  <span class="type">double</span> v11; <span class="comment">// [rsp+440h] [rbp-80h]</span></span><br><span class="line">  <span class="type">char</span> *v12; <span class="comment">// [rsp+448h] [rbp-78h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+450h] [rbp-70h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v14; <span class="comment">// [rsp+454h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v15; <span class="comment">// [rsp+45Ah] [rbp-66h]</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [rsp+45Bh] [rbp-65h]</span></span><br><span class="line">  <span class="type">int</span> n; <span class="comment">// [rsp+45Ch] [rbp-64h]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [rsp+460h] [rbp-60h]</span></span><br><span class="line">  <span class="type">char</span> v19; <span class="comment">// [rsp+467h] [rbp-59h]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+468h] [rbp-58h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+46Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">char</span> v22; <span class="comment">// [rsp+473h] [rbp-4Dh]</span></span><br><span class="line">  <span class="type">int</span> v23; <span class="comment">// [rsp+474h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v24; <span class="comment">// [rsp+478h] [rbp-48h]</span></span><br><span class="line">  <span class="type">int</span> v25; <span class="comment">// [rsp+484h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">int</span> v26; <span class="comment">// [rsp+488h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v27; <span class="comment">// [rsp+48Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">char</span> v28; <span class="comment">// [rsp+490h] [rbp-30h]</span></span><br><span class="line">  <span class="type">bool</span> v29; <span class="comment">// [rsp+491h] [rbp-2Fh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v30; <span class="comment">// [rsp+492h] [rbp-2Eh]</span></span><br><span class="line">  <span class="type">int</span> v31; <span class="comment">// [rsp+494h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v32; <span class="comment">// [rsp+498h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+49Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">int</span> v34; <span class="comment">// [rsp+4A0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j; <span class="comment">// [rsp+4A4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">char</span> *haystack; <span class="comment">// [rsp+4A8h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  haystack = <span class="number">0</span>;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  v32 = <span class="number">0</span>;</span><br><span class="line">  v31 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">  v30 = <span class="number">0</span>;</span><br><span class="line">  v29 = <span class="number">0</span>;</span><br><span class="line">  v28 = <span class="number">0</span>;</span><br><span class="line">  v27 = <span class="number">90</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v26 = getopt_long(a1, a2, <span class="string">&quot;eshiItnd:f:r:R:c:C:W:H:&quot;</span>, &amp;longopts, &amp;longind);</span><br><span class="line">    <span class="keyword">if</span> ( v26 == <span class="number">-1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v26 &amp;&amp; !*((_QWORD *)&amp;longopts.flag + <span class="number">4</span> * longind) )</span><br><span class="line">      v26 = *(&amp;longopts.val + <span class="number">8</span> * longind);</span><br><span class="line">    <span class="keyword">switch</span> ( v26 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;C&#x27;</span>:</span><br><span class="line">        dword_E1F8 = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;H&#x27;</span>:</span><br><span class="line">        dword_E1EC = (<span class="number">64</span> - atoi(optarg)) / <span class="number">2</span>;</span><br><span class="line">        dword_E1F0 = (atoi(optarg) + <span class="number">64</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>:</span><br><span class="line">        v28 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;R&#x27;</span>:</span><br><span class="line">        dword_E1F0 = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">        dword_E1F4 = (<span class="number">64</span> - atoi(optarg)) / <span class="number">2</span>;</span><br><span class="line">        dword_E1F8 = (atoi(optarg) + <span class="number">64</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">        dword_E1F4 = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> ( atoi(optarg) &gt; <span class="number">9</span> &amp;&amp; atoi(optarg) &lt;= <span class="number">1000</span> )</span><br><span class="line">          v27 = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">        dword_E104 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">        dword_104C4 = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">        sub_67F0(a2);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">        v29 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">        dword_E1EC = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        dword_E108 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">        dword_104C0 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_104C0 )</span><br><span class="line">  &#123;</span><br><span class="line">    v29 = v28 == <span class="number">0</span>;</span><br><span class="line">    sub_6669();</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0xFF</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *((_BYTE *)&amp;unk_104E0 + i) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_66AF(*((<span class="type">unsigned</span> __int8 *)&amp;unk_104E0 + i), i);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0xFF</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *((_BYTE *)&amp;unk_105E0 + i) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_66AF(*((<span class="type">unsigned</span> __int8 *)&amp;unk_105E0 + i), i);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    signal(<span class="number">14</span>, sub_64C0);</span><br><span class="line">    <span class="keyword">if</span> ( !_setjmp(env) )</span><br><span class="line">    &#123;</span><br><span class="line">      alarm(<span class="number">1u</span>);</span><br><span class="line">      <span class="keyword">while</span> ( !feof(<span class="built_in">stdin</span>) &amp;&amp; v32 &lt;= <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = getchar();</span><br><span class="line">        v15 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v16 == <span class="number">-1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v16 = getchar();</span><br><span class="line">          <span class="keyword">switch</span> ( v16 )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-16</span>:</span><br><span class="line">              v31 = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">if</span> ( LOBYTE(s[<span class="number">0</span>]) == <span class="number">24</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                alarm(<span class="number">2u</span>);</span><br><span class="line">                haystack = strndup((<span class="type">const</span> <span class="type">char</span> *)s + <span class="number">2</span>, <span class="number">0x3FEu</span>);</span><br><span class="line">                ++v32;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> ( LOBYTE(s[<span class="number">0</span>]) == <span class="number">31</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                alarm(<span class="number">2u</span>);</span><br><span class="line">                dword_E1FC = (BYTE1(s[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) | BYTE2(s[<span class="number">0</span>]);</span><br><span class="line">                dword_E200 = (BYTE3(s[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) | BYTE4(s[<span class="number">0</span>]);</span><br><span class="line">                ++v32;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-15</span>:</span><br><span class="line">              sub_66AF(<span class="number">241</span>, <span class="number">0</span>);</span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-6</span>:</span><br><span class="line">              v31 = <span class="number">1</span>;</span><br><span class="line">              v30 = <span class="number">0</span>;</span><br><span class="line">              <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x400u</span>);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-5</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-4</span>:</span><br><span class="line">              v15 = getchar();</span><br><span class="line">              <span class="keyword">if</span> ( !*((_BYTE *)&amp;unk_105E0 + v15) )</span><br><span class="line">                *((_BYTE *)&amp;unk_105E0 + v15) = <span class="number">-4</span>;</span><br><span class="line">              sub_66AF(*((<span class="type">unsigned</span> __int8 *)&amp;unk_105E0 + v15), v15);</span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">              <span class="keyword">if</span> ( v16 == <span class="number">-5</span> &amp;&amp; v15 == <span class="number">24</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c%c%c&quot;</span>, <span class="number">255</span>, <span class="number">250</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">255</span>, <span class="number">240</span>);</span><br><span class="line">                fflush(<span class="built_in">stdout</span>);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-3</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-2</span>:</span><br><span class="line">              v15 = getchar();</span><br><span class="line">              <span class="keyword">if</span> ( !*((_BYTE *)&amp;unk_104E0 + v15) )</span><br><span class="line">                *((_BYTE *)&amp;unk_104E0 + v15) = <span class="number">-2</span>;</span><br><span class="line">              sub_66AF(*((<span class="type">unsigned</span> __int8 *)&amp;unk_104E0 + v15), v15);</span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">              v32 = <span class="number">2</span>;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( v31 &amp;&amp; v30 &lt;= <span class="number">0x3FEu</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          *((_BYTE *)s + v30++) = v16;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    alarm(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    haystack = getenv(<span class="string">&quot;TERM&quot;</span>);</span><br><span class="line">    ioctl(<span class="number">0</span>, <span class="number">0x5413u</span>, v5);</span><br><span class="line">    dword_E1FC = v5[<span class="number">1</span>];</span><br><span class="line">    dword_E200 = v5[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  v34 = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> ( haystack )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = j;</span><br><span class="line">      <span class="keyword">if</span> ( v3 &gt;= <span class="built_in">strlen</span>(haystack) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      haystack[j] = <span class="built_in">tolower</span>(haystack[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;xterm&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;toaru&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;linux&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;vtnt&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;cygwin&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;vt220&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">6</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;fallback&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;rxvt-256color&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;rxvt&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(haystack, <span class="string">&quot;vt100&quot;</span>) &amp;&amp; dword_E1FC == <span class="number">40</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(haystack, <span class="string">&quot;st&quot;</span>, <span class="number">2u</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v34 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v25 = <span class="number">0</span>;</span><br><span class="line">  signal(<span class="number">2</span>, sub_64A8);</span><br><span class="line">  signal(<span class="number">13</span>, sub_64E6);</span><br><span class="line">  <span class="keyword">if</span> ( !dword_104C0 )</span><br><span class="line">    signal(<span class="number">28</span>, handler);</span><br><span class="line">  <span class="keyword">switch</span> ( v34 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      qword_FE20 = (__int64)<span class="string">&quot;\x1B[48;5;17m&quot;</span>;</span><br><span class="line">      qword_FE30 = (__int64)<span class="string">&quot;\x1B[48;5;231m&quot;</span>;</span><br><span class="line">      qword_FDF8 = (__int64)<span class="string">&quot;\x1B[48;5;16m&quot;</span>;</span><br><span class="line">      qword_FEC0 = (__int64)<span class="string">&quot;\x1B[48;5;230m&quot;</span>;</span><br><span class="line">      qword_FDE0 = (__int64)<span class="string">&quot;\x1B[48;5;175m&quot;</span>;</span><br><span class="line">      qword_FE28 = (__int64)<span class="string">&quot;\x1B[48;5;162m&quot;</span>;</span><br><span class="line">      qword_FEB0 = (__int64)<span class="string">&quot;\x1B[48;5;196m&quot;</span>;</span><br><span class="line">      qword_FDF0 = (__int64)<span class="string">&quot;\x1B[48;5;214m&quot;</span>;</span><br><span class="line">      qword_FE18 = (__int64)<span class="string">&quot;\x1B[48;5;226m&quot;</span>;</span><br><span class="line">      qword_FDD8 = (__int64)<span class="string">&quot;\x1B[48;5;118m&quot;</span>;</span><br><span class="line">      qword_FEA8 = (__int64)<span class="string">&quot;\x1B[48;5;33m&quot;</span>;</span><br><span class="line">      qword_FE98 = (__int64)<span class="string">&quot;\x1B[48;5;19m&quot;</span>;</span><br><span class="line">      qword_FE10 = (__int64)<span class="string">&quot;\x1B[48;5;240m&quot;</span>;</span><br><span class="line">      qword_FDE8 = (__int64)<span class="string">&quot;\x1B[48;5;175m&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      qword_FE20 = (__int64)<span class="string">&quot;\x1B[104m&quot;</span>;</span><br><span class="line">      qword_FE30 = (__int64)<span class="string">&quot;\x1B[107m&quot;</span>;</span><br><span class="line">      qword_FDF8 = (__int64)<span class="string">&quot;\x1B[40m&quot;</span>;</span><br><span class="line">      qword_FEC0 = (__int64)<span class="string">&quot;\x1B[47m&quot;</span>;</span><br><span class="line">      qword_FDE0 = (__int64)<span class="string">&quot;\x1B[105m&quot;</span>;</span><br><span class="line">      qword_FE28 = (__int64)<span class="string">&quot;\x1B[101m&quot;</span>;</span><br><span class="line">      qword_FEB0 = (__int64)<span class="string">&quot;\x1B[101m&quot;</span>;</span><br><span class="line">      qword_FDF0 = (__int64)<span class="string">&quot;\x1B[43m&quot;</span>;</span><br><span class="line">      qword_FE18 = (__int64)<span class="string">&quot;\x1B[103m&quot;</span>;</span><br><span class="line">      qword_FDD8 = (__int64)<span class="string">&quot;\x1B[102m&quot;</span>;</span><br><span class="line">      qword_FEA8 = (__int64)<span class="string">&quot;\x1B[104m&quot;</span>;</span><br><span class="line">      qword_FE98 = (__int64)<span class="string">&quot;\x1B[44m&quot;</span>;</span><br><span class="line">      qword_FE10 = (__int64)<span class="string">&quot;\x1B[100m&quot;</span>;</span><br><span class="line">      qword_FDE8 = (__int64)<span class="string">&quot;\x1B[105m&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      qword_FE20 = (__int64)<span class="string">&quot;\x1B[25;44m&quot;</span>;</span><br><span class="line">      qword_FE30 = (__int64)<span class="string">&quot;\x1B[5;47m&quot;</span>;</span><br><span class="line">      qword_FDF8 = (__int64)<span class="string">&quot;\x1B[25;40m&quot;</span>;</span><br><span class="line">      qword_FEC0 = (__int64)<span class="string">&quot;\x1B[5;47m&quot;</span>;</span><br><span class="line">      qword_FDE0 = (__int64)<span class="string">&quot;\x1B[5;45m&quot;</span>;</span><br><span class="line">      qword_FE28 = (__int64)<span class="string">&quot;\x1B[5;41m&quot;</span>;</span><br><span class="line">      qword_FEB0 = (__int64)<span class="string">&quot;\x1B[5;41m&quot;</span>;</span><br><span class="line">      qword_FDF0 = (__int64)<span class="string">&quot;\x1B[25;43m&quot;</span>;</span><br><span class="line">      qword_FE18 = (__int64)<span class="string">&quot;\x1B[5;43m&quot;</span>;</span><br><span class="line">      qword_FDD8 = (__int64)<span class="string">&quot;\x1B[5;42m&quot;</span>;</span><br><span class="line">      qword_FEA8 = (__int64)<span class="string">&quot;\x1B[25;44m&quot;</span>;</span><br><span class="line">      qword_FE98 = (__int64)<span class="string">&quot;\x1B[5;44m&quot;</span>;</span><br><span class="line">      qword_FE10 = (__int64)<span class="string">&quot;\x1B[5;40m&quot;</span>;</span><br><span class="line">      qword_FDE8 = (__int64)<span class="string">&quot;\x1B[5;45m&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      qword_FE20 = (__int64)<span class="string">&quot;\x1B[0;34;44m&quot;</span>;</span><br><span class="line">      qword_FE30 = (__int64)<span class="string">&quot;\x1B[1;37;47m&quot;</span>;</span><br><span class="line">      qword_FDF8 = (__int64)<span class="string">&quot;\x1B[0;30;40m&quot;</span>;</span><br><span class="line">      qword_FEC0 = (__int64)<span class="string">&quot;\x1B[1;37;47m&quot;</span>;</span><br><span class="line">      qword_FDE0 = (__int64)<span class="string">&quot;\x1B[1;35;45m&quot;</span>;</span><br><span class="line">      qword_FE28 = (__int64)<span class="string">&quot;\x1B[1;31;41m&quot;</span>;</span><br><span class="line">      qword_FEB0 = (__int64)<span class="string">&quot;\x1B[1;31;41m&quot;</span>;</span><br><span class="line">      qword_FDF0 = (__int64)<span class="string">&quot;\x1B[0;33;43m&quot;</span>;</span><br><span class="line">      qword_FE18 = (__int64)<span class="string">&quot;\x1B[1;33;43m&quot;</span>;</span><br><span class="line">      qword_FDD8 = (__int64)<span class="string">&quot;\x1B[1;32;42m&quot;</span>;</span><br><span class="line">      qword_FEA8 = (__int64)<span class="string">&quot;\x1B[1;34;44m&quot;</span>;</span><br><span class="line">      qword_FE98 = (__int64)<span class="string">&quot;\x1B[0;34;44m&quot;</span>;</span><br><span class="line">      qword_FE10 = (__int64)<span class="string">&quot;\x1B[1;30;40m&quot;</span>;</span><br><span class="line">      qword_FDE8 = (__int64)<span class="string">&quot;\x1B[1;35;45m&quot;</span>;</span><br><span class="line">      off_FA88 = (<span class="type">char</span> *)&amp;unk_BCFF;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">      qword_FE20 = (__int64)<span class="string">&quot;\x1B[0;34;44m&quot;</span>;</span><br><span class="line">      qword_FE30 = (__int64)<span class="string">&quot;\x1B[1;37;47m&quot;</span>;</span><br><span class="line">      qword_FDF8 = (__int64)<span class="string">&quot;\x1B[0;30;40m&quot;</span>;</span><br><span class="line">      qword_FEC0 = (__int64)<span class="string">&quot;\x1B[1;37;47m&quot;</span>;</span><br><span class="line">      qword_FDE0 = (__int64)<span class="string">&quot;\x1B[1;35;45m&quot;</span>;</span><br><span class="line">      qword_FE28 = (__int64)<span class="string">&quot;\x1B[1;31;41m&quot;</span>;</span><br><span class="line">      qword_FEB0 = (__int64)<span class="string">&quot;\x1B[1;31;41m&quot;</span>;</span><br><span class="line">      qword_FDF0 = (__int64)<span class="string">&quot;\x1B[0;33;43m&quot;</span>;</span><br><span class="line">      qword_FE18 = (__int64)<span class="string">&quot;\x1B[1;33;43m&quot;</span>;</span><br><span class="line">      qword_FDD8 = (__int64)<span class="string">&quot;\x1B[1;32;42m&quot;</span>;</span><br><span class="line">      qword_FEA8 = (__int64)<span class="string">&quot;\x1B[1;34;44m&quot;</span>;</span><br><span class="line">      qword_FE98 = (__int64)<span class="string">&quot;\x1B[0;34;44m&quot;</span>;</span><br><span class="line">      qword_FE10 = (__int64)<span class="string">&quot;\x1B[1;30;40m&quot;</span>;</span><br><span class="line">      qword_FDE8 = (__int64)<span class="string">&quot;\x1B[1;35;45m&quot;</span>;</span><br><span class="line">      off_FA88 = (<span class="type">char</span> *)&amp;unk_BD06;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">      qword_FE20 = (__int64)&amp;unk_BD09;</span><br><span class="line">      qword_FE30 = (__int64)&amp;unk_BD0C;</span><br><span class="line">      qword_FDF8 = (__int64)<span class="string">&quot;  &quot;</span>;</span><br><span class="line">      qword_FEC0 = (__int64)&amp;unk_BD0F;</span><br><span class="line">      qword_FDE0 = (__int64)&amp;unk_BD12;</span><br><span class="line">      qword_FE28 = (__int64)&amp;unk_BD15;</span><br><span class="line">      qword_FEB0 = (__int64)&amp;unk_BD0F;</span><br><span class="line">      qword_FDF0 = (__int64)&amp;unk_BD18;</span><br><span class="line">      qword_FE18 = (__int64)&amp;unk_BD1B;</span><br><span class="line">      qword_FDD8 = (__int64)&amp;unk_BD1E;</span><br><span class="line">      qword_FEA8 = (__int64)&amp;unk_BD21;</span><br><span class="line">      qword_FE98 = (__int64)&amp;unk_BD24;</span><br><span class="line">      qword_FE10 = (__int64)&amp;unk_BD27;</span><br><span class="line">      qword_FDE8 = (__int64)&amp;unk_BD2A;</span><br><span class="line">      v25 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">      qword_FE20 = (__int64)&amp;unk_BD2D;</span><br><span class="line">      qword_FE30 = (__int64)&amp;unk_BD2F;</span><br><span class="line">      qword_FDF8 = (__int64)&amp;unk_BD31;</span><br><span class="line">      qword_FEC0 = (__int64)&amp;unk_BD33;</span><br><span class="line">      qword_FDE0 = (__int64)&amp;unk_BD35;</span><br><span class="line">      qword_FE28 = (__int64)&amp;unk_BD37;</span><br><span class="line">      qword_FEB0 = (__int64)&amp;unk_BD33;</span><br><span class="line">      qword_FDF0 = (__int64)&amp;unk_BD39;</span><br><span class="line">      qword_FE18 = (__int64)&amp;unk_BD3B;</span><br><span class="line">      qword_FDD8 = (__int64)&amp;unk_BD3D;</span><br><span class="line">      qword_FEA8 = (__int64)&amp;unk_BD3F;</span><br><span class="line">      qword_FE98 = (__int64)&amp;unk_BD41;</span><br><span class="line">      qword_FE10 = (__int64)&amp;unk_BD43;</span><br><span class="line">      qword_FDE8 = (__int64)&amp;unk_BD45;</span><br><span class="line">      v25 = <span class="number">1</span>;</span><br><span class="line">      dword_E1FC = <span class="number">40</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_E1F4 == dword_E1F8 )</span><br><span class="line">  &#123;</span><br><span class="line">    dword_E1F4 = (dword_E1FC / <span class="number">-2</span> + <span class="number">64</span>) / <span class="number">2</span>;</span><br><span class="line">    dword_E1F8 = (dword_E1FC / <span class="number">2</span> + <span class="number">64</span>) / <span class="number">2</span>;</span><br><span class="line">    byte_104CB = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_E1EC == dword_E1F0 )</span><br><span class="line">  &#123;</span><br><span class="line">    dword_E1EC = (<span class="number">65</span> - dword_E200) / <span class="number">2</span>;</span><br><span class="line">    dword_E1F0 = (dword_E200 + <span class="number">63</span>) / <span class="number">2</span>;</span><br><span class="line">    byte_104CC = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_E108 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\x1BkNyanyanyanyanyanyanya...\x1B\\&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\x1B]1;Nyanyanyanyanyanyanya...\a&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\x1B]2;Nyanyanyanyanyanyanya...\a&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_E104 )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\x1B[H\x1B[2J\x1B[?25l&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\x1B[s&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v29 )</span><br><span class="line">  &#123;</span><br><span class="line">    v14 = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v14; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_65E2(<span class="number">3</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;                             \x1B[1mNyancat Telnet Server\x1B[0m&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">2</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;                   written and run by \x1B[1;32mK. Lange\x1B[1;34m @_klange\x1B[0m&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">2</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;        If things don&#x27;t look right, try:&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">1</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;                TERM=fallback telnet ...&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">2</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;        Or on Windows:&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">1</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;                telnet -t vtnt ...&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">2</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;        Problems? Check the website:&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">1</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;                \x1B[1;34mhttp://nyancat.dakko.us\x1B[0m&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">2</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;        This is a telnet server, remember your escape keys!&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">1</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;                \x1B[1;31m^]quit\x1B[0m to exit&quot;</span>);</span><br><span class="line">      sub_65E2(<span class="number">2</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;        Starting in %d...                \n&quot;</span>, v14 - j);</span><br><span class="line">      fflush(<span class="built_in">stdout</span>);</span><br><span class="line">      usleep(<span class="number">0x61A80u</span>);</span><br><span class="line">      <span class="keyword">if</span> ( dword_E104 )</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1B[H&quot;</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1B[u&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( dword_E104 )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;\x1B[H\x1B[2J\x1B[?25l&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  time(&amp;timer);</span><br><span class="line">  v13 = <span class="number">1</span>;</span><br><span class="line">  v24 = <span class="number">0</span>;</span><br><span class="line">  v23 = <span class="number">0</span>;</span><br><span class="line">  v22 = <span class="number">0</span>;</span><br><span class="line">  v12 = off_FA88;</span><br><span class="line">  <span class="keyword">while</span> ( v13 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( dword_E104 )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;\x1B[H&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;\x1B[u&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> ( k = dword_E1EC; k &lt; dword_E1F0; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( m = dword_E1F4; m &lt; dword_E1F8; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( k &lt;= <span class="number">23</span> || k &gt; <span class="number">42</span> || m &gt;= <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( m &gt;= <span class="number">0</span> &amp;&amp; (<span class="type">unsigned</span> <span class="type">int</span>)k &lt; <span class="number">0x40</span> &amp;&amp; m &lt;= <span class="number">63</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v19 = off_FA20[v24][k][m];</span><br><span class="line">            off_FA88 = (<span class="type">char</span> *)sub_6314((<span class="type">unsigned</span> <span class="type">int</span>)v24, (<span class="type">unsigned</span> <span class="type">int</span>)k, (<span class="type">unsigned</span> <span class="type">int</span>)m, v12);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v19 = <span class="number">44</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v18 = (<span class="number">2</span> - m) % <span class="number">16</span> / <span class="number">8</span>;</span><br><span class="line">          <span class="keyword">if</span> ( ((v24 &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">            v18 = <span class="number">1</span> - v18;</span><br><span class="line">          s[<span class="number">128</span>] = <span class="string">&quot;,,&gt;&gt;&amp;&amp;&amp;+++###==;;;,,&quot;</span>;</span><br><span class="line">          v19 = asc_BFE3[v18 - <span class="number">23</span> + k];</span><br><span class="line">          <span class="keyword">if</span> ( !v19 )</span><br><span class="line">            v19 = <span class="number">44</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v25 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, *((<span class="type">const</span> <span class="type">char</span> **)&amp;unk_FCC0 + v19));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( v19 == v22 || !*((_QWORD *)&amp;unk_FCC0 + v19) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, off_FA88);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v22 = v19;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%s%s&quot;</span>, *((<span class="type">const</span> <span class="type">char</span> **)&amp;unk_FCC0 + v19), off_FA88);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      sub_65E2(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( dword_E100 )</span><br><span class="line">    &#123;</span><br><span class="line">      time(&amp;time1);</span><br><span class="line">      v11 = difftime(time1, timer);</span><br><span class="line">      v10 = sub_63FF((<span class="type">unsigned</span> <span class="type">int</span>)(<span class="type">int</span>)v11);</span><br><span class="line">      <span class="keyword">for</span> ( n = (dword_E1FC - <span class="number">29</span> - v10) / <span class="number">2</span>; n &gt; <span class="number">0</span>; --n )</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">32</span>);</span><br><span class="line">      dword_E1E8 += <span class="built_in">printf</span>(<span class="string">&quot;\x1B[1;37mYou have nyaned for %d times!\x1B[J\x1B[0m&quot;</span>, ++dword_108E0);</span><br><span class="line">    &#125;</span><br><span class="line">    v22 = <span class="number">0</span>;</span><br><span class="line">    ++v23;</span><br><span class="line">    <span class="keyword">if</span> ( dword_104C4 &amp;&amp; v23 == dword_104C4 )</span><br><span class="line">      sub_6471();</span><br><span class="line">    <span class="keyword">if</span> ( !off_FA20[++v24] )</span><br><span class="line">      v24 = <span class="number">0</span>;</span><br><span class="line">    usleep(<span class="number">1000</span> * v27);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到这一部分，<code>printf(&quot;%s&quot;, off_FA88);</code>这里我们进一步跟进 <code>off_FA88</code><br>看到了对它的赋值操作 <code>off_FA88 = sub_6314((unsigned int)v24, k, m, (__int64)v12);</code><br>此时我们查看<code>sub_6314</code>的源代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( m &gt;= <span class="number">0</span> &amp;&amp; (<span class="type">unsigned</span> <span class="type">int</span>)k &lt; <span class="number">0x40</span> &amp;&amp; m &lt;= <span class="number">63</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v19 = off_FA20[v24][k][m];</span><br><span class="line">            off_FA88 = (<span class="type">char</span> *)sub_6314((<span class="type">unsigned</span> <span class="type">int</span>)v24, (<span class="type">unsigned</span> <span class="type">int</span>)k, (<span class="type">unsigned</span> <span class="type">int</span>)m, v12);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v19 = <span class="number">44</span>;</span><br></pre></td></tr></table></figure>

<p>以下是<code>sub_6314</code>的代码：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">sub_6314</span><span class="params">(__int64 a1, <span class="type">int</span> a2, <span class="type">int</span> a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a2 != <span class="number">18</span> )</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">char</span> *)a4;</span><br><span class="line">  <span class="keyword">if</span> ( a3 &lt;= <span class="number">4</span> || a3 &gt; <span class="number">54</span> )</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">char</span> *)a4;</span><br><span class="line">  byte_104C9 = <span class="number">32</span>;</span><br><span class="line">  dword_E120[a3 - <span class="number">5</span>] ^= sub_62B5();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_62E3(dword_E120[a3 - <span class="number">5</span>]) )</span><br><span class="line">    byte_104C8 = dword_E120[a3 - <span class="number">5</span>] &amp; <span class="number">0x7F</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    byte_104C8 = <span class="number">32</span>;</span><br><span class="line">  <span class="keyword">return</span> &amp;byte_104C8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sub_62B5</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_62B5</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  dword_E1E8 = <span class="number">1103515245</span> * dword_E1E8 + <span class="number">12345</span>;</span><br><span class="line">  <span class="keyword">return</span> (dword_E1E8 &gt;&gt; <span class="number">10</span>) &amp; <span class="number">0x7FFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sub_62E3</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">sub_62E3</span><span class="params">(<span class="type">char</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 &amp; <span class="number">0x7Fu</span>) &lt;= <span class="number">0x7E</span> &amp;&amp; (a1 &amp; <span class="number">0x7Fu</span>) &gt; <span class="number">0x20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>dword_E120</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">.data:<span class="number">000000000000E120</span> dword_E120      dd <span class="number">27F</span>Bh, <span class="number">27</span>A4h, <span class="number">464</span>Eh, <span class="number">0E36</span>h, <span class="number">7B</span>70h, <span class="number">5E7</span>Ah, <span class="number">1</span>A4Ah, <span class="number">45</span>C1h</span><br><span class="line">.data:<span class="number">000000000000E120</span>                                         ; DATA XREF: sub_6314+<span class="number">5</span>C↑o</span><br><span class="line">.data:<span class="number">000000000000E120</span>                                         ; sub_6314+<span class="number">7</span>A↑o ...</span><br><span class="line">.data:<span class="number">000000000000E140</span>                 dd <span class="number">2B</span>DFh, <span class="number">23B</span>Dh, <span class="number">3</span>A15h, <span class="number">5B</span>83h, <span class="number">1E15</span>h, <span class="number">5367</span>h, <span class="number">50B</span>8h, <span class="number">20</span>CAh</span><br><span class="line">.data:<span class="number">000000000000E160</span>                 dd <span class="number">41F</span>5h, <span class="number">57</span>D1h, <span class="number">7750</span>h, <span class="number">2</span>ADFh, <span class="number">11F</span>8h, <span class="number">9B</span>Bh, <span class="number">5724</span>h, <span class="number">7374</span>h</span><br><span class="line">.data:<span class="number">000000000000E180</span>                 dd <span class="number">3</span>CE6h, <span class="number">646</span>Eh, <span class="number">10</span>Ch, <span class="number">6E10</span>h, <span class="number">64F</span>4h, <span class="number">3263</span>h, <span class="number">3137</span>h, <span class="number">0B</span>8h</span><br><span class="line">.data:<span class="number">000000000000E1</span>A0                 dd <span class="number">229</span>Ch, <span class="number">7B</span>CDh, <span class="number">73B</span>Dh, <span class="number">480</span>Ch, <span class="number">14</span>DBh, <span class="number">68B</span>9h, <span class="number">5</span>C8Ah, <span class="number">1B</span>61h</span><br><span class="line">.data:<span class="number">000000000000E1</span>C0                 dd <span class="number">6</span>C59h, <span class="number">5707</span>h, <span class="number">9E6</span>h, <span class="number">1F</span>B9h, <span class="number">2</span>AD3h, <span class="number">76</span>D4h, <span class="number">3113</span>h, <span class="number">7</span>C7Eh</span><br><span class="line">.data:<span class="number">000000000000E1</span>E0                 dd <span class="number">11E0</span>h, <span class="number">6</span>C70h</span><br></pre></td></tr></table></figure>

<p>结合上述思路，那么可以发现这个程序应该逆向的顺序为:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">off_FA88-&gt;dword_<span class="number">108E0</span>-&gt;dword_E<span class="number">1E8</span></span><br></pre></td></tr></table></figure>

<h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dword_E1E8 = <span class="number">0x1106</span></span><br><span class="line">dword_E120 = [</span><br><span class="line">    <span class="number">0x27fb</span>, <span class="number">0x27a4</span>, <span class="number">0x464e</span>, <span class="number">0x0e36</span>, <span class="number">0x7b70</span>, <span class="number">0x5e7a</span>, <span class="number">0x1a4a</span>, <span class="number">0x45c1</span>,</span><br><span class="line">    <span class="number">0x2bdf</span>, <span class="number">0x23bd</span>, <span class="number">0x3a15</span>, <span class="number">0x5b83</span>, <span class="number">0x1e15</span>, <span class="number">0x5367</span>, <span class="number">0x50b8</span>, <span class="number">0x20ca</span>,</span><br><span class="line">    <span class="number">0x41f5</span>, <span class="number">0x57d1</span>, <span class="number">0x7750</span>, <span class="number">0x2adf</span>, <span class="number">0x11f8</span>, <span class="number">0x09bb</span>, <span class="number">0x5724</span>, <span class="number">0x7374</span>,</span><br><span class="line">    <span class="number">0x3ce6</span>, <span class="number">0x646e</span>, <span class="number">0x010c</span>, <span class="number">0x6e10</span>, <span class="number">0x64f4</span>, <span class="number">0x3263</span>, <span class="number">0x3137</span>, <span class="number">0x00b8</span>,</span><br><span class="line">    <span class="number">0x229c</span>, <span class="number">0x7bcd</span>, <span class="number">0x73bd</span>, <span class="number">0x480c</span>, <span class="number">0x14db</span>, <span class="number">0x68b9</span>, <span class="number">0x5c8a</span>, <span class="number">0x1b61</span>,</span><br><span class="line">    <span class="number">0x6c59</span>, <span class="number">0x5707</span>, <span class="number">0x09e6</span>, <span class="number">0x1fb9</span>, <span class="number">0x2ad3</span>, <span class="number">0x76d4</span>, <span class="number">0x3113</span>, <span class="number">0x7c7e</span>,</span><br><span class="line">    <span class="number">0x11e0</span>, <span class="number">0x6c70</span></span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_62B5</span>():</span><br><span class="line">    <span class="keyword">global</span> dword_E1E8</span><br><span class="line">    dword_E1E8 = (<span class="number">1103515245</span> * dword_E1E8 + <span class="number">12345</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> (dword_E1E8 &gt;&gt; <span class="number">10</span>) &amp; <span class="number">0x7FFF</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">llog</span>(<span class="params">n</span>):</span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &gt;= <span class="number">10</span>:</span><br><span class="line">        n //= <span class="number">10</span></span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_62E3</span>(<span class="params">a1</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0x7E</span> &gt;= (a1 &amp; <span class="number">0x7F</span>) &gt; <span class="number">0x20</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        dword_E120[i] ^= sub_62B5()</span><br><span class="line"> </span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    dword_E1E8 += <span class="number">42</span> + llog(count)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> count % <span class="number">1000000</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Count: <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    flag = <span class="built_in">bytearray</span>(<span class="number">51</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> sub_62E3(dword_E120[i]):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        flag[i] = dword_E120[i] &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> flag[:<span class="number">6</span>] == <span class="string">b&#x27;CatCTF&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag.decode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Count: <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~/Git-Projects/CTF_Challenges/Reverse/CatFly$ python3 exp.py </span><br><span class="line">Count: 1000000</span><br><span class="line">Count: 2000000</span><br><span class="line">Count: 3000000</span><br><span class="line">Count: 4000000</span><br><span class="line">Count: 5000000</span><br><span class="line">Count: 6000000</span><br><span class="line">Count: 7000000</span><br><span class="line">Count: 8000000</span><br><span class="line">Count: 9000000</span><br><span class="line">Count: 10000000</span><br><span class="line">Count: 11000000</span><br><span class="line">Count: 12000000</span><br><span class="line">Count: 13000000</span><br><span class="line">Count: 14000000</span><br><span class="line">Count: 15000000</span><br><span class="line">Count: 16000000</span><br><span class="line">Count: 17000000</span><br><span class="line">Count: 18000000</span><br><span class="line">Count: 19000000</span><br><span class="line">Count: 20000000</span><br><span class="line">Count: 21000000</span><br><span class="line">Count: 22000000</span><br><span class="line">Count: 23000000</span><br><span class="line">Count: 24000000</span><br><span class="line">Count: 25000000</span><br><span class="line">Count: 26000000</span><br><span class="line">Count: 27000000</span><br><span class="line">Count: 28000000</span><br><span class="line">Count: 29000000</span><br><span class="line">Count: 30000000</span><br><span class="line">Count: 31000000</span><br><span class="line">Count: 32000000</span><br><span class="line">Count: 33000000</span><br><span class="line">Count: 34000000</span><br><span class="line">Count: 35000000</span><br><span class="line">Count: 36000000</span><br><span class="line">Count: 37000000</span><br><span class="line">Count: 38000000</span><br><span class="line">Count: 39000000</span><br><span class="line">Count: 40000000</span><br><span class="line">Count: 41000000</span><br><span class="line">Count: 42000000</span><br><span class="line">Count: 43000000</span><br><span class="line">Count: 44000000</span><br><span class="line">Count: 45000000</span><br><span class="line">Count: 46000000</span><br><span class="line">Count: 47000000</span><br><span class="line">Count: 48000000</span><br><span class="line">Count: 49000000</span><br><span class="line">Count: 50000000</span><br><span class="line">Count: 51000000</span><br><span class="line">Count: 52000000</span><br><span class="line">Count: 53000000</span><br><span class="line">Count: 54000000</span><br><span class="line">Count: 55000000</span><br><span class="line">Count: 56000000</span><br><span class="line">Count: 57000000</span><br><span class="line">Count: 58000000</span><br><span class="line">Count: 59000000</span><br><span class="line">Count: 60000000</span><br><span class="line">Count: 61000000</span><br><span class="line">Count: 62000000</span><br><span class="line">Count: 63000000</span><br><span class="line">Count: 64000000</span><br><span class="line">Count: 65000000</span><br><span class="line">Count: 66000000</span><br><span class="line">Count: 67000000</span><br><span class="line">Count: 68000000</span><br><span class="line">Count: 69000000</span><br><span class="line">Count: 70000000</span><br><span class="line">Count: 71000000</span><br><span class="line">Count: 72000000</span><br><span class="line">Count: 73000000</span><br><span class="line">Count: 74000000</span><br><span class="line">Count: 75000000</span><br><span class="line">Count: 76000000</span><br><span class="line">Count: 77000000</span><br><span class="line">Count: 78000000</span><br><span class="line">Count: 79000000</span><br><span class="line">Count: 80000000</span><br><span class="line">Count: 81000000</span><br><span class="line">Count: 82000000</span><br><span class="line">Count: 83000000</span><br><span class="line">Count: 84000000</span><br><span class="line">Count: 85000000</span><br><span class="line">Count: 86000000</span><br><span class="line">Count: 87000000</span><br><span class="line">Count: 88000000</span><br><span class="line">Count: 89000000</span><br><span class="line">Count: 90000000</span><br><span class="line">Count: 91000000</span><br><span class="line">Count: 92000000</span><br><span class="line">Count: 93000000</span><br><span class="line">Count: 94000000</span><br><span class="line">Count: 95000000</span><br><span class="line">Count: 96000000</span><br><span class="line">Count: 97000000</span><br><span class="line">Count: 98000000</span><br><span class="line">Count: 99000000</span><br><span class="line">Count: 100000000</span><br><span class="line">CatCTF&#123;Fly1NG_NyAnC4t_Cha5eS_the_FL4G_in_The_Sky&#125;</span><br><span class="line">Count: 100001958</span><br></pre></td></tr></table></figure>


	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2025/08/28/crypto-basic-math-knowledge/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2025/08/26/adworld-easyRE/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2025-08-26 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Reverse/">Reverse<span>2</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Reverse/">Reverse<span>3</span></a></li> <li><a href="/tags/CTF/">CTF<span>9</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 hakmaple's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
